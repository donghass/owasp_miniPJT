{% extends 'base.html' %}
{% block title %}메인 | 공공 의료 민원 포털{% endblock %}

{% block hero %}
<section class="hero hero-main">
  <p class="eyebrow">Public Health Service</p>
  <h1>공공의료 정보와 민원 처리를 한 곳에서 관리하는 포털</h1>
  <p>예방접종, 의료비 지원, 정신건강 연계 등 공공 의료정보를 확인하고 의료 민원을 온라인으로 접수/추적할 수 있습니다.</p>
  <div class="hero-actions">
    <a class="btn" href="{{ url_for('complaints_new') if current_user.is_authenticated else url_for('login') }}">민원 접수하기</a>
    <a class="btn btn-outline" href="{{ url_for('health_info') }}">의료정보 보기</a>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="home-section-stack">
<div class="grid grid-3">
  <section class="quick-stat">
    <span class="small">서비스 분야</span>
    <b>공공 의료 · 민원</b>
  </section>
  <section class="quick-stat">
    <span class="small">핵심 기능</span>
    <b>민원 접수 · 처리 추적</b>
  </section>
  <section class="quick-stat">
    <span class="small">지원 범위</span>
    <b>정보 안내 · 관리자 처리</b>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <div class="split">
      <h3>공공 의료 주요 정보</h3>
      <a class="btn btn-subtle" href="{{ url_for('health_info') }}">전체 보기</a>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>항목</th><th>대상</th><th>안내 채널</th></tr></thead>
        <tbody>
          {% for item in health_news %}
          <tr>
            <td class="text-wrap"><strong>{{ item.title }}</strong><br><span class="small">{{ item.summary }}</span></td>
            <td>{{ item.target }}</td>
            <td>{{ item.channel }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="split">
      <h3>주요 지원사업</h3>
      <a class="btn btn-subtle" href="{{ url_for('health_info') }}">상세 보기</a>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>사업명</th><th>분야</th><th>상세</th></tr></thead>
        <tbody>
          {% for program in highlighted_programs %}
          <tr>
            <td class="text-wrap">{{ program.name }}</td>
            <td>{{ program.category }}</td>
            <td><a class="btn btn-subtle" href="{{ url_for('health_program_detail', program_id=program.id) }}">열기</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <div class="split">
      <h3>민원 유형 가이드 + 처리기한</h3>
      <a class="btn btn-subtle" href="{{ url_for('complaints_guide') }}">전체 가이드</a>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>유형</th><th>설명</th><th>처리기한</th></tr></thead>
        <tbody>
          {% for item in complaint_type_guide %}
          <tr>
            <td>{{ item.category }}</td>
            <td class="text-wrap">{{ item.description }}</td>
            <td>{{ item.sla_days }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="split">
      <h3>예방접종/검진 일정</h3>
      <a class="btn btn-subtle" href="{{ url_for('health_calendar') }}">일정 보기</a>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>월</th><th>일정</th><th>대상</th></tr></thead>
        <tbody>
          {% for item in schedule_preview %}
          <tr>
            <td>{{ item.month }}</td>
            <td class="text-wrap">{{ item.title }}</td>
            <td>{{ item.target }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <div class="split">
      <h3>의료비 지원사업 안내</h3>
      <a class="btn btn-subtle" href="{{ url_for('support_programs') }}">상세 보기</a>
    </div>
    <div class="table-wrap">
      <table class="table">
        <thead><tr><th>사업명</th><th>대상</th><th>지원</th></tr></thead>
        <tbody>
          {% for p in support_preview %}
          <tr>
            <td class="text-wrap">{{ p.name }}</td>
            <td>{{ p.target }}</td>
            <td class="text-wrap">{{ p.benefit }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <div class="split">
      <h3>의무기록/개인정보 절차 안내</h3>
      <a class="btn btn-subtle" href="{{ url_for('records_procedure') }}">절차 보기</a>
    </div>
    <p class="small">
      의무기록 열람·정정, 개인정보 처리 문의는 본인확인 절차 후 처리됩니다.
      처리 상태 설명이 필요한 경우 <a href="{{ url_for('complaints_faq') }}">민원 FAQ</a>를 확인하세요.
    </p>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <div class="split">
      <h3>최근 공지사항</h3>
      <a class="btn btn-subtle" href="{{ url_for('notices_list') }}">전체 보기</a>
    </div>
    {% if latest_notices %}
      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>제목</th><th>작성일</th></tr></thead>
          <tbody>
            {% for notice in latest_notices %}
            <tr>
              <td class="text-wrap"><a href="{{ url_for('notices_detail', notice_id=notice.id) }}">{{ notice.title }}</a></td>
              <td>{{ notice.created_at.strftime('%Y-%m-%d') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">등록된 공지가 없습니다.</p>
    {% endif %}
  </section>

  <section class="card">
    <div class="split">
      <h3>최근 민원/문의 게시글</h3>
      <a class="btn btn-subtle" href="{{ url_for('posts_list') }}">전체 보기</a>
    </div>
    {% if latest_posts %}
      <div class="table-wrap">
        <table class="table">
          <thead><tr><th>분류</th><th>제목</th><th>작성자</th></tr></thead>
          <tbody>
            {% for post in latest_posts %}
            <tr>
              <td><span class="badge badge-open">{{ post_category_labels.get(post.category, post.category) }}</span></td>
              <td class="text-wrap"><a href="{{ url_for('posts_detail', post_id=post.id) }}">{{ post.title }}</a></td>
              <td>{{ post.author.username }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">등록된 게시물이 없습니다.</p>
    {% endif %}
  </section>
</div>

</div>
{% endblock %}
